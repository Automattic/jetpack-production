!function(e,t){for(var n in t)e[n]=t[n]}(window,function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=474)}({0:function(e,t){e.exports=window.wp.element},1:function(e,t){e.exports=window.wp.i18n},130:function(e,t,n){e.exports=n.p+"images/map-theme_default-2ceb449b599dbcbe2a90fead5a5f3824.jpg"},131:function(e,t,n){e.exports=n.p+"images/map-theme_black_and_white-1ead5946ca104d83676d6e3410e1d733.jpg"},132:function(e,t,n){e.exports=n.p+"images/map-theme_satellite-c74dc129bda9502fb0fb362bb627577e.jpg"},133:function(e,t,n){e.exports=n.p+"images/map-theme_terrain-2b6e6c1c8d09cbdc58a4c0653be1a6e3.jpg"},134:function(e){e.exports=JSON.parse('[{"id":"mapbox-gl-js","file":"node_modules/mapbox-gl/dist/mapbox-gl.js","version":"1.13.0"},{"id":"mapbox-gl-css","file":"node_modules/mapbox-gl/dist/mapbox-gl.css","version":"1.13.0"}]')},136:function(e,t,n){"use strict";var o=n(5),r=n.n(o),a=n(0),i=n(1),s=n(3),l=n(2),c=(n(209),n(54));class p extends a.Component{constructor(...e){super(...e),r()(this,"handleClick",(()=>{const{onClick:e}=this.props;e(this)})),r()(this,"getPoint",(()=>{const{point:e}=this.props;return[e.coordinates.longitude,e.coordinates.latitude]}))}componentDidMount(){this.renderMarker()}componentWillUnmount(){this.marker&&this.marker.remove()}componentDidUpdate(){this.renderMarker()}renderMarker(){const{map:e,point:t,mapboxgl:n,markerColor:o,mapRef:r}=this.props,{handleClick:a}=this,i=[t.coordinates.longitude,t.coordinates.latitude],{currentDoc:s}=Object(c.a)(r.current),l=this.marker?this.marker.getElement():s.createElement("div");this.marker?this.marker.setLngLat(i):(l.className="wp-block-jetpack-map-marker",this.marker=new n.Marker(l).setLngLat(i).setOffset([0,-19]).addTo(e),this.marker.getElement().addEventListener("click",a)),l.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg version="1.1" viewBox="0 0 32 38" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g fill-rule="evenodd"><path id="d" d="m16 38s16-11.308 16-22-7.1634-16-16-16-16 5.3076-16 16 16 22 16 22z" fill="'+o+'" mask="url(#c)"/></g></svg>'}render(){return null}}p.defaultProps={point:{},map:null,markerColor:"#000000",mapboxgl:null,onClick:()=>{}};var d=p;class u extends a.Component{constructor(...e){super(...e),r()(this,"closeClick",(()=>{this.props.unsetActiveMarker()}))}componentDidMount(){const{mapboxgl:e}=this.props;this.el=document.createElement("DIV"),this.infowindow=new e.Popup({closeButton:!0,closeOnClick:!1,offset:{left:[0,0],top:[0,5],right:[0,0],bottom:[0,-40]}}),this.infowindow.setDOMContent(this.el),this.infowindow.on("close",this.closeClick)}componentDidUpdate(e){this.props.activeMarker!==e.activeMarker&&(this.props.activeMarker?this.openWindow():this.closeWindow())}render(){return this.el?Object(a.createPortal)(this.props.children,this.el):null}openWindow(){const{map:e,activeMarker:t}=this.props;this.infowindow.setLngLat(t.getPoint()).addTo(e)}closeWindow(){this.infowindow.remove()}}u.defaultProps={unsetActiveMarker:()=>{},activeMarker:null,map:null,mapboxgl:null};var m=u;var h=n(134);class b extends a.Component{constructor(){super(...arguments),r()(this,"onMarkerClick",(e=>{const{onMarkerClick:t}=this.props;this.setState({activeMarker:e}),t()})),r()(this,"onMapClick",(()=>{this.setState({activeMarker:null})})),r()(this,"clearCurrentMarker",(()=>{this.setState({activeMarker:null})})),r()(this,"updateActiveMarker",(e=>{const{points:t}=this.props,{activeMarker:n}=this.state,{index:o}=n.props,r=t.slice(0);Object(s.assign)(r[o],e),this.props.onSetPoints(r)})),r()(this,"deleteActiveMarker",(()=>{const{points:e}=this.props,{activeMarker:t}=this.state,{index:n}=t.props,o=e.slice(0);o.splice(n,1),this.props.onSetPoints(o),this.setState({activeMarker:null})})),r()(this,"sizeMap",(()=>{const{mapHeight:e}=this.props,{map:t}=this.state,n=this.mapRef.current;if(e)n.style.height=e+"px";else{const e=n.offsetWidth,t=window.location.search.indexOf("map-block-counter")>-1?window.innerHeight:.8*window.innerHeight,o=Math.min(e*(3/4),t);n.style.height=o+"px"}t.resize(),this.setBoundsByMarkers()})),r()(this,"updateZoom",(()=>{const{zoom:e}=this.props,{map:t}=this.state;t.setZoom(e),t.updateZoom(e)})),r()(this,"setBoundsByMarkers",(()=>{const{admin:e,onSetMapCenter:t,onSetZoom:n,points:o,zoom:r}=this.props,{map:a,activeMarker:i,mapboxgl:s,zoomControl:l,boundsSetProgrammatically:c}=this.state;if(!a)return;if(o.length&&e?a.dragPan.disable():a.dragPan.enable(),!o.length)return;if(i)return;const p=new s.LngLatBounds;if(o.forEach((e=>{p.extend([e.coordinates.longitude,e.coordinates.latitude])})),t(p.getCenter()),o.length>1){a.fitBounds(p,{padding:{top:80,bottom:80,left:40,right:40}}),this.setState({boundsSetProgrammatically:!0});try{a.removeControl(l)}catch(d){}}else{if(a.setCenter(p.getCenter()),c){const e=12;a.setZoom(e),n(e)}else a.setZoom(parseInt(r,10));a.addControl(l),this.setState({boundsSetProgrammatically:!1})}})),r()(this,"scriptsLoaded",(()=>{const{mapCenter:e,points:t}=this.props;this.setState({loaded:!0}),t.length,this.initMap(e)})),r()(this,"googlePoint2Mapbox",(e=>e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")?e:{lat:e.latitude||0,lng:e.longitude||0})),this.state={map:null,fit_to_bounds:!1,loaded:!1,mapboxgl:null},this.mapRef=Object(a.createRef)(),this.debouncedSizeMap=Object(s.debounce)(this.sizeMap,250)}render(){const{points:e,admin:t,children:n,markerColor:o}=this.props,{map:r,activeMarker:c,mapboxgl:p}=this.state,{onMarkerClick:u,deleteActiveMarker:h,updateActiveMarker:b}=this,f=Object(s.get)(c,"props.point")||{},{title:g,caption:k}=f,w=a.Children.map(n,(e=>{if("AddPoint"===Object(s.get)(e,"props.tagName"))return e})),v=r&&p&&e.map(((e,t)=>Object(a.createElement)(d,{mapRef:this.mapRef,key:t,point:e,index:t,map:r,mapboxgl:p,markerColor:o,onClick:u}))),j=p&&Object(a.createElement)(m,{activeMarker:c,map:r,mapboxgl:p,unsetActiveMarker:()=>this.setState({activeMarker:null})},c&&t&&Object(a.createElement)(a.Fragment,null,Object(a.createElement)(l.TextControl,{label:Object(i.__)("Marker Title","jetpack"),value:g,onChange:e=>b({title:e})}),Object(a.createElement)(l.TextareaControl,{className:"wp-block-jetpack-map__marker-caption",label:Object(i.__)("Marker Caption","jetpack"),value:k,rows:"2",tag:"textarea",onChange:e=>b({caption:e})}),Object(a.createElement)(l.Button,{onClick:h,className:"wp-block-jetpack-map__delete-btn"},Object(a.createElement)(l.Dashicon,{icon:"trash",size:"15"})," ",Object(i.__)("Delete Marker","jetpack"))),c&&!t&&Object(a.createElement)(a.Fragment,null,Object(a.createElement)("h3",null,g),Object(a.createElement)("p",null,k)));return Object(a.createElement)(a.Fragment,null,Object(a.createElement)("div",{className:"wp-block-jetpack-map__gm-container",ref:this.mapRef},v),j,w)}componentDidMount(){const{apiKey:e}=this.props;e&&this.loadMapLibraries()}componentWillUnmount(){this.debouncedSizeMap.cancel(),window.removeEventListener("resize",this.debouncedSizeMap)}componentDidUpdate(e){const{admin:t,apiKey:n,children:o,points:r,mapStyle:a,mapDetails:i,scrollToZoom:s,showFullscreenButton:l}=this.props,{map:c,fullscreenControl:p}=this.state;n&&n.length>0&&n!==e.apiKey&&this.loadMapLibraries(),o!==e.children&&!1!==o&&this.clearCurrentMarker(),r!==e.points&&this.setBoundsByMarkers(),r.length!==e.points.length&&this.clearCurrentMarker(),a===e.mapStyle&&i===e.mapDetails||c.setStyle(this.getMapStyle()),s!==e.scrollToZoom&&(s?c.scrollZoom.enable():c.scrollZoom.disable()),l!==e.showFullscreenButton&&(l?(c.addControl(p),t&&p._fullscreenButton&&(p._fullscreenButton.disabled=!0)):c.removeControl(p))}getMapStyle(){const{mapStyle:e,mapDetails:t}=this.props;return function(e,t){return{default:{details:"mapbox://styles/automattic/cjolkhmez0qdd2ro82dwog1in",no_details:"mapbox://styles/automattic/cjolkci3905d82soef4zlmkdo"},black_and_white:{details:"mapbox://styles/automattic/cjolkixvv0ty42spgt2k4j434",no_details:"mapbox://styles/automattic/cjolkgc540tvj2spgzzoq37k4"},satellite:{details:"mapbox://styles/mapbox/satellite-streets-v10",no_details:"mapbox://styles/mapbox/satellite-v9"},terrain:{details:"mapbox://styles/automattic/cjolkf8p405fh2soet2rdt96b",no_details:"mapbox://styles/automattic/cjolke6fz12ys2rpbpvgl12ha"}}[e][t?"details":"no_details"]}(e,t)}getMapType(){const{mapStyle:e}=this.props;switch(e){case"satellite":return"HYBRID";case"terrain":return"TERRAIN";case"black_and_white":default:return"ROADMAP"}}loadMapLibraries(){const{apiKey:e}=this.props,{currentWindow:t}=Object(c.a)(this.mapRef.current),n={"mapbox-gl-js":()=>{Object(c.d)(t,"mapboxgl").then((t=>{t.accessToken=e,this.setState({mapboxgl:t},this.scriptsLoaded)}))}};Object(c.b)(h,n,this.mapRef.current)}initMap(e){const{mapboxgl:t}=this.state,{zoom:n,onMapLoaded:o,onError:r,scrollToZoom:a,showFullscreenButton:i,admin:s}=this.props;let l=null;try{l=new t.Map({container:this.mapRef.current,style:this.getMapStyle(),center:this.googlePoint2Mapbox(e),zoom:parseInt(n,10),pitchWithRotate:!1,attributionControl:!1,dragRotate:!1})}catch(d){return void r("mapbox_error",d.message)}a||l.scrollZoom.disable();const c=new t.FullscreenControl;l.on("error",(e=>{r("mapbox_error",e.error.message)}));const p=new t.NavigationControl({showCompass:!1,showZoom:!0});l.on("zoomend",(()=>{this.props.onSetZoom(l.getZoom())})),l.on("moveend",(()=>{const{onSetMapCenter:e,points:t}=this.props;t.length<1&&e(l.getCenter())})),l.getCanvas().addEventListener("click",this.onMapClick),this.setState({map:l,zoomControl:p,fullscreenControl:c},(()=>{this.debouncedSizeMap(),l.addControl(p),i&&(l.addControl(c),s&&c._fullscreenButton&&(c._fullscreenButton.disabled=!0)),this.mapRef.current.addEventListener("alignmentChanged",this.debouncedSizeMap),l.resize(),o(),this.setState({loaded:!0}),window.addEventListener("resize",this.debouncedSizeMap)}))}}b.defaultProps={points:[],mapStyle:"default",zoom:13,onSetZoom:()=>{},onSetMapCenter:()=>{},onMapLoaded:()=>{},onMarkerClick:()=>{},onError:()=>{},markerColor:"red",apiKey:null,mapCenter:{}};t.a=b},2:function(e,t){e.exports=window.wp.components},209:function(e,t,n){},210:function(e,t,n){},28:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var o=n(0),r=n(1),a=n(130),i=n.n(a),s=n(131),l=n.n(s),c=n(132),p=n.n(c),d=n(133),u=n.n(d);const m={name:"map",prefix:"jetpack",title:Object(r.__)("Map","jetpack"),icon:Object(o.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false"},Object(o.createElement)("path",{fill:"none",d:"M0 0h24v24H0V0z"}),Object(o.createElement)("path",{d:"M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM10 5.47l4 1.4v11.66l-4-1.4V5.47zm-5 .99l3-1.01v11.7l-3 1.16V6.46zm14 11.08l-3 1.01V6.86l3-1.16v11.84z"})),category:"embed",keywords:[Object(r._x)("maps","block search term","jetpack"),Object(r._x)("location","block search term","jetpack"),Object(r._x)("navigation","block search term","jetpack")],description:Object(r.__)("Add an interactive map showing one or more locations.","jetpack"),attributes:{align:{type:"string"},points:{type:"array",default:[]},mapDetails:{type:"boolean",default:!0},zoom:{type:"integer",default:13},mapCenter:{type:"object",default:{longitude:-122.41941550000001,latitude:37.7749295}},markerColor:{type:"string",default:"red"},preview:{type:"boolean",default:!1},scrollToZoom:{type:"boolean",default:!1},mapHeight:{type:"integer"},showFullscreenButton:{type:"boolean",default:!0}},supports:{defaultStylePicker:!1,html:!1},styles:[{name:"default",label:Object(r.__)("Basic","jetpack"),preview:i.a,isDefault:!0},{name:"black_and_white",label:Object(r.__)("Black and white","jetpack"),preview:l.a},{name:"satellite",label:Object(r.__)("Satellite","jetpack"),preview:p.a},{name:"terrain",label:Object(r.__)("Terrain","jetpack"),preview:u.a}],validAlignments:["center","wide","full"],markerIcon:Object(o.createElement)("svg",{width:"14",height:"20",viewBox:"0 0 14 20",xmlns:"http://www.w3.org/2000/svg"},Object(o.createElement)("g",{id:"Page-1",fill:"none",fillRule:"evenodd"},Object(o.createElement)("g",{id:"outline-add_location-24px",transform:"translate(-5 -2)"},Object(o.createElement)("polygon",{id:"Shape",points:"0 0 24 0 24 24 0 24"}),Object(o.createElement)("path",{d:"M12,2 C8.14,2 5,5.14 5,9 C5,14.25 12,22 12,22 C12,22 19,14.25 19,9 C19,5.14 15.86,2 12,2 Z M7,9 C7,6.24 9.24,4 12,4 C14.76,4 17,6.24 17,9 C17,11.88 14.12,16.19 12,18.88 C9.92,16.21 7,11.85 7,9 Z M13,6 L11,6 L11,8 L9,8 L9,10 L11,10 L11,12 L13,12 L13,10 L15,10 L15,8 L13,8 L13,6 Z",id:"Shape",fill:"#000",fillRule:"nonzero"})))),example:{attributes:{preview:!0}}}},3:function(e,t){e.exports=window.lodash},32:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(82),r=n.n(o),a=n(3);function i(e,t){const n=function(e,t){for(const n of new r.a(t).values()){if(-1===n.indexOf("is-style-"))continue;const t=n.substring(9),o=Object(a.find)(e,{name:t});if(o)return o}return Object(a.find)(e,"isDefault")}(e,t);return n?n.name:null}},38:function(e,t,n){"object"==typeof window&&window.Jetpack_Block_Assets_Base_Url&&window.Jetpack_Block_Assets_Base_Url.url&&(n.p=window.Jetpack_Block_Assets_Base_Url.url)},42:function(e,t,n){"use strict";n.r(t);n(38)},47:function(e,t){e.exports=window.wp.domReady},474:function(e,t,n){n(42),e.exports=n(505)},5:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},505:function(e,t,n){"use strict";n.r(t);var o=n(47),r=n.n(o),a=(n(210),n(136)),i=n(28),s=n(3),l=n(0);var c=class{blockIterator(e,t){t.forEach((t=>{this.initializeFrontendReactBlocks(t.component,t.options,e)}))}initializeFrontendReactBlocks(e,t={},n){const{attributes:o,name:r,prefix:a}=t.settings,{selector:i}=t,c=`.wp-block-${(a&&a.length?`${a}/${r}`:r).replace("/","-")}`,p=n.querySelectorAll(c);for(const d of p){if("true"===d.getAttribute("data-jetpack-block-initialized"))continue;const n=this.extractAttributesFromContainer(d,o);Object(s.assign)(n,t.props);const r=this.extractChildrenFromContainer(d),a=Object(l.createElement)(e,n,r);Object(l.render)(a,i?d.querySelector(i):d),d.setAttribute("data-jetpack-block-initialized",!0)}}extractAttributesFromContainer(e,t){const n={};for(const r in t){const a=t[r],i="data-"+Object(s.kebabCase)(r);if(n[r]=e.getAttribute(i),"boolean"===a.type&&(n[r]="false"!==n[r]&&!!n[r]),"array"===a.type||"object"===a.type)try{n[r]=JSON.parse(n[r])}catch(o){n[r]=null}}return n}extractChildrenFromContainer(e){return[...e.childNodes].map((e=>{const t={};for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n];t[o.nodeName]=o.nodeValue}return t.dangerouslySetInnerHTML={__html:e.innerHTML},Object(l.createElement)(e.tagName.toLowerCase(),t)}))}},p=n(32);r()((function(){(new c).blockIterator(document,[{component:a.a,options:{settings:{...i.a,attributes:{...i.a.attributes,mapStyle:Object(p.a)(i.a.styles,i.a.className),apiKey:{type:"string",default:""}}}}}])}))},54:function(e,t,n){"use strict";function o(e){const t=e.ownerDocument;return{currentDoc:t,currentWindow:t.defaultView||t.parentWindow}}function r(e,t,n=!1){var r;let a=[];if(!t||!e&&!e.length||!function(e){const{currentWindow:t}=o(e);return"editor-canvas"===t.name&&t.self!==t.top}(t))return a;const{currentDoc:i,currentWindow:s}=o(t);if(!function(e){try{var t;return!(null==e||null===(t=e.parent)||void 0===t||!t.location.href)}catch(n){return!1}}(s))return a;const l=null==s||null===(r=s.parent)||void 0===r?void 0:r.document;return i&&l?(a=e.filter((e=>{const t=l.querySelector(e),o=!!i.querySelector(e);return!(!t||o)&&(i.head.appendChild(t.cloneNode()),n&&t.remove(),!0)})),a):void 0}function a(e,t,n){const r=`${window.Jetpack_Block_Assets_Base_Url.url}editor-assets`,{currentDoc:a}=o(n),i=a.getElementsByTagName("head")[0];e.forEach((e=>{const[n,o]=e.file.split("/").pop().split(".");if("css"===o){if(a.getElementById(e.id))return;const t=a.createElement("link");t.id=e.id,t.rel="stylesheet",t.href=`${r}/${n}-${e.version}.${o}`,i.appendChild(t)}if("js"===o){const s=t[e.id]?t[e.id]:null;if(a.getElementById(e.id))return s();const l=a.createElement("script");l.id=e.id,l.type="text/javascript",l.src=`${r}/${n}-${e.version}.${o}`,l.onload=s,i.appendChild(l)}}))}function i(e,t){return new Promise((n=>{const o=()=>{e[t]?n(e[t]):e.requestAnimationFrame(o)};o()}))}n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return i}))},82:function(e,t){e.exports=window.wp.tokenList}}));