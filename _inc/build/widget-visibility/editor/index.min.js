!function(){"use strict";var e={399:function(e){e.exports=window.wp.blockEditor},997:function(e){e.exports=window.wp.components},417:function(e){e.exports=window.wp.compose},27:function(e){e.exports=window.wp.element},163:function(e){e.exports=window.wp.i18n}},t={};function a(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,a),o.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};!function(){var e=a(27),t=a(997),i=a(163),l=a(399),o=a(417);const __=i.__,_x=i._x,n={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" "},c=/&(?:amp|lt|gt|quot|#39|nbsp);/g,s=e=>{if("string"!=typeof e)return e;return e.replace(c,(e=>n[e]))},r=e=>!new Set(["core/legacy-widget","core/widget-area"]).has(e);wp.hooks.addFilter("blocks.registerBlockType","widget/visibility",(function(e,t){return r(t)&&void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{conditions:{type:"object",default:{}}})),e}));const d=(e,t=0)=>e.reduce(((e,a)=>{const[i,l]=a,o=" ".repeat(3*t);if(Array.isArray(l)){const a={label:s(o+i),value:i,disabled:!0},n=d(l,t+1);return e.concat([a]).concat(n)}const n={label:s(o+l),value:i};return e.concat([n])}),[]),u=e=>{const{rule:a,onDelete:i,setMajor:l,setMinor:o}=e,n=[{label:__("User","jetpack"),value:"loggedin"},{label:__("Role","jetpack"),value:"role"}],c="undefined"!=typeof wpcom,s=widget_conditions_data.taxonomy&&widget_conditions_data.taxonomy.length>1||"taxonomy"===a.major,r=[{label:__("Taxonomy","jetpack"),value:"taxonomy"}],u=[{label:__("-- Select --","jetpack"),value:""},{label:__("Category","jetpack"),value:"category"},{label:__("Author","jetpack"),value:"author"}].concat(c?[]:n).concat([{label:__("Tag","jetpack"),value:"tag"},{label:__("Date","jetpack"),value:"date"},{label:__("Page","jetpack"),value:"page"}]).concat(s?r:[]);let m=[];return a.major in widget_conditions_data&&(m=d(widget_conditions_data[a.major])),React.createElement("div",{className:"widget-vis__rule"},React.createElement("div",{className:"widget-vis__rule-major"},React.createElement("span",{className:"widget-vis__if"},_x("If","Widget Visibility: If {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{label:__("Major Rule","jetpack"),hideLabelFromVision:!0,value:a.major,options:u,onChange:l}))),a.major&&React.createElement("div",{className:"widget-vis__rule-minor"},React.createElement("span",{className:"widget-vis__is"},_x("is","Widget Visibility: {Rule Major [Page]} is {Rule Minor [Search results]}","jetpack")),React.createElement("div",{className:"widget-vis__select"},React.createElement(t.SelectControl,{className:"widget-vis__select-multi-level",label:__("Minor Rule","jetpack"),hideLabelFromVision:!0,value:a.minor,options:m,onChange:o}))),React.createElement("div",{className:"widget-vis__delete-rule"},React.createElement(t.Button,{onClick:i,isSmall:!0,isSecondary:!0},_x("Remove","Delete this visibility rule","jetpack"))))},m=e=>({action:"show",rules:[],match_all:0,...e}),p=(0,o.createHigherOrderComponent)((a=>i=>{const{attributes:o,setAttributes:n,isSelected:c}=i,s=(0,e.useMemo)((()=>o.conditions||{}),[o]),d=(0,e.useMemo)((()=>s.rules||[]),[s]),p=(0,e.useCallback)((()=>n({conditions:{...m(s),match_all:"0"===s.match_all?"1":"0"}})),[n,s]),g=(0,e.useCallback)((e=>n({conditions:{...m(s),action:e}})),[n,s]),w=(0,e.useCallback)((()=>{const e=[...d,{major:"",minor:""}];n({conditions:{...m(s),rules:e}})}),[n,s,d]),_=(0,e.useCallback)((e=>{const t=[...d.slice(0,e),...d.slice(e+1)];n({conditions:{...m(s),rules:t}})}),[n,s,d]),b=(0,e.useCallback)(((e,t)=>{let a="";t in widget_conditions_data&&Array.isArray(widget_conditions_data[t])&&widget_conditions_data[t].length>0&&(a=widget_conditions_data[t][0][0]);const i=[...d.slice(0,e),{...d[e],major:t,minor:a},...d.slice(e+1)];n({conditions:{...m(s),rules:i}})}),[n,s,d]),v=(0,e.useCallback)(((e,t)=>{if(t&&t.includes("__HEADER__"))return;const a=[...d.slice(0,e),{...d[e],minor:t},...d.slice(e+1)];n({conditions:{...m(s),rules:a}})}),[n,s,d]);let k=null;return k=0===d.length?React.createElement(t.BaseControl,{id:"widget-vis__wrapper",className:"widget-vis__wrapper",label:__("Visibility","jetpack"),help:__("No visibility rules yet. Add at least one rule to use this feature.","jetpack")},React.createElement(t.Button,{isSecondary:!0,onClick:w,className:"widget-vis__add-new-rule"},__("Add new rule","jetpack"))):React.createElement(t.BaseControl,{className:"widget-vis__wrapper",id:"widget-vis__wrapper",label:__("Visibility","jetpack")},React.createElement(t.SelectControl,{className:"widget-vis__show-hide",label:__("Action","jetpack"),hideLabelFromVision:!0,value:o.action,options:[{label:__("Show this block","jetpack"),value:"show"},{label:__("Hide this block","jetpack"),value:"hide"}],onChange:g}),d.map(((e,t)=>React.createElement(u,{key:t,rule:e,i:t,onDelete:()=>_(t),setMajor:e=>b(t,e),setMinor:e=>v(t,e)}))),d.length>1&&React.createElement(t.ToggleControl,{className:"widget-vis__match-all",label:__("Match all rules","jetpack"),checked:"1"===s.match_all,onChange:p}),React.createElement(t.Button,{isSecondary:!0,onClick:w},__("Add new rule","jetpack"))),React.createElement(e.Fragment,null,React.createElement(a,i),c&&r(i.name)&&React.createElement(l.InspectorAdvancedControls,null,k))}),"visibilityAdvancedControls");wp.hooks.addFilter("editor.BlockEdit","widget/visibility",p)}(),window.WidgetVisibility={}.WidgetVisibility}();