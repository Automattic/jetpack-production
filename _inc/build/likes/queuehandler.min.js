(()=>{var e=[],t=!1,n=2e3,i=[],o=new Promise((e=>{"loading"!==document.readyState?e():window.addEventListener("DOMContentLoaded",(()=>e()))}));function l(e,t){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return}if(t&&"function"==typeof t.postMessage)try{t.postMessage(JSON.stringify({type:"likesMessage",data:e}),"*")}catch(e){return}}function a(){const t=[];document.querySelectorAll("div.jetpack-likes-widget-unloaded").forEach((n=>{if(!(e.indexOf(n.id)>-1)&&c(n)){e.push(n.id);var i,o=/like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/.exec(n.id);o&&5===o.length&&(i={blog_id:o[2],width:n.width},"post"===o[1]?i.post_id=o[3]:"comment"===o[1]&&(i.comment_id=o[3]),i.obj_id=o[4],t.push(i))}})),t.length>0&&l({event:"initialBatch",requests:t},window.frames["likes-master"])}function r(){var e;if(t){!function(){for(let e=i.length-1;e>=0;e--){const t=i[e];if(!c(t)){const n=t&&t.parentElement&&t.parentElement.parentElement;n.classList.remove("jetpack-likes-widget-loaded"),n.classList.remove("jetpack-likes-widget-loading"),n.classList.add("jetpack-likes-widget-unloaded"),n.querySelectorAll(".comment-likes-widget-placeholder").forEach((e=>e.style.display="block")),i.splice(e,1),t.remove()}}}();var n=[...document.querySelectorAll("div.jetpack-likes-widget-unloaded")].filter((e=>c(e)));n.length>0&&a();for(var o=0,l=n.length;o<=l-1;o++)(e=n[o].id)&&s(e)}else setTimeout(r,500)}function s(e){if(void 0===e)return;const t=document.querySelector("#"+e);t.querySelectorAll("iframe").forEach((e=>e.remove()));const n=t.querySelector(".likes-widget-placeholder");if(n&&n.classList.contains("post-likes-widget-placeholder")){const e=document.createElement("iframe");e.classList.add("post-likes-widget","jetpack-likes-widget"),e.name=t.dataset.name,e.src=t.dataset.src,e.height="55px",e.width="100%",e.frameBorder="0",e.scrolling="no",e.title=t.dataset.title,n.after(e)}if(n.classList.contains("comment-likes-widget-placeholder")){const e=document.createElement("iframe");e.class="comment-likes-widget-frame jetpack-likes-widget-frame",e.name=t.dataset.name,e.src=t.dataset.src,e.height="18px",e.width="100%",e.frameBorder="0",e.scrolling="no",t.querySelector(".comment-like-feedback").after(e),i.push(e)}t.classList.remove("jetpack-likes-widget-unloaded"),t.classList.add("jetpack-likes-widget-loading"),t.querySelector("iframe").addEventListener("load",(e=>{l({event:"loadLikeWidget",name:e.target.name,width:e.target.width},window.frames["likes-master"]),t.classList.remove("jetpack-likes-widget-loading"),t.classList.add("jetpack-likes-widget-loaded")}))}function c(e){const t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t+n>=0&&i<=window.innerHeight+n}window.addEventListener("message",(function(e){let n=e&&e.data;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){return}const i=n&&n.type,r=n&&n.data;if("likesMessage"!==i||void 0===r.event)return;if("https://widgets.wp.com"===e.origin)switch(r.event){case"masterReady":o.then((()=>{t=!0;const e={event:"injectStyles"},n=document.querySelector(".sd-text-color"),i=document.querySelector(".sd-link-color"),o=n&&getComputedStyle(n)||{},r=i&&getComputedStyle(i)||{};if(document.querySelectorAll("iframe.admin-bar-likes-widget").length>0){l({event:"adminBarEnabled"},window.frames["likes-master"]);const t=document.querySelector("#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a"),n=document.querySelector("#wpadminbar");e.adminBarStyles={background:t&&getComputedStyle(t).background,isRtl:n&&"rtl"===getComputedStyle(n).direction}}document.body.classList.contains("single")&&l({event:"reblogsEnabled"},window.frames["likes-master"]),e.textStyles={color:o.color,fontFamily:o["font-family"],fontSize:o["font-size"],direction:o.direction,fontWeight:o["font-weight"],fontStyle:o["font-style"],textDecoration:o["text-decoration"]},e.linkStyles={color:r.color,fontFamily:r["font-family"],fontSize:r["font-size"],textDecoration:r["text-decoration"],fontWeight:r["font-weight"],fontStyle:r["font-style"]},l(e,window.frames["likes-master"]),a()}));break;case"showLikeWidget":{const e=document.querySelector(`#${r.id} .likes-widget-placeholder`);e&&(e.style.display="none");break}case"showCommentLikeWidget":{const e=document.querySelector(`#${r.id} .likes-widget-placeholder`);e&&(e.style.display="none");break}case"killCommentLikes":document.querySelectorAll(".jetpack-comment-likes-widget-wrapper").forEach((e=>e.remove()));break;case"clickReblogFlair":wpcom_reblog&&"function"==typeof wpcom_reblog.toggle_reblog_box_flair&&wpcom_reblog.toggle_reblog_box_flair(r.obj_id);break;case"hideOtherGravatars":{const e=window.document.querySelector(`iframe[name='${r.parent}']`);e&&e.nextElementSibling&&"likes-other-gravatars"===e.nextElementSibling.id&&e.nextElementSibling.remove();break}case"showOtherGravatars":{const e=document.querySelector("#likers-base-popover");if(!e)break;const t=window.document.querySelector(`iframe[name='${r.parent}']`);if(t&&t.nextElementSibling&&"likes-other-gravatars"===t.nextElementSibling.id){t.nextElementSibling.remove();break}const n=e.cloneNode(!0);n.id="likes-other-gravatars";const i=n.classList.contains("wpl-new-layout"),o=n.querySelector("ul");n.style.display="none",o.innerHTML="",i?n.querySelectorAll(".likes-text span").forEach((e=>e.textContent=r.totalLikesLabel)):n.querySelectorAll(".likes-text span").forEach((e=>e.textContent=r.total)),(r.likers||[]).forEach((e=>{if("http"!==e.profile_URL.substr(0,4))return;const t=document.createElement("li");t.innerHTML=i?`\n\t\t\t\t\t\t<a href="${encodeURI(e.profile_URL)}" rel="nofollow" target="_parent" class="wpl-liker">\n\t\t\t\t\t\t\t<img src="${encodeURI(e.avatar_URL)}"\n\t\t\t\t\t\t\t\talt=""\n\t\t\t\t\t\t\t\tstyle="width: 28px; height: 28px;" />\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`:`\n\t\t\t\t\t\t<a href="${encodeURI(e.profile_URL)}" rel="nofollow" target="_parent" class="wpl-liker">\n\t\t\t\t\t\t\t<img src="${encodeURI(e.avatar_URL)}"\n\t\t\t\t\t\t\t\talt=""\n\t\t\t\t\t\t\t\tstyle="width: 30px; height: 30px; padding-right: 3px;" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`,o.append(t),t.classList.add(e.css_class),t.querySelector("img").alt=e.name,i&&(t.querySelector("span").innerText=e.name)}));const l="rtl"===getComputedStyle(e).direction,a=document.querySelector(`*[name='${r.parent}']`),s=a.getBoundingClientRect(),c=a.ownerDocument.defaultView,d={top:s.top+c.pageYOffset,left:s.left+c.pageXOffset};if(i){let e=a.parentElement.getBoundingClientRect();if(n.style.top=s.top-e.top+"px",l){const e=r&&r.likers?Math.min(r.likers.length,5):0;n.style.left=r.position.left+24*e+4+"px",n.style.transform="translateX(-100%)"}else n.style.left=r.position.left+"px"}else n.style.left=d.left+r.position.left-10+"px",n.style.top=d.top+r.position.top-33+"px";const m=Math.floor(r.width/37);let p=37*Math.ceil(r.likers.length/m)+13;if(p>204&&(p=204),!i){const e=37*m-7;n.style.height=p+"px",n.style.width=e+"px";const t=37*m;o.style.width=t+"px";const i=o.offsetWidth-o.clientWidth;i>0&&(n.style.width=e+i+"px",o.style.width=t+i+"px")}n.style.display="block",n.setAttribute("aria-hidden","false"),t.after(n)}}})),document.addEventListener("click",(e=>{const t=document.querySelector("#likes-other-gravatars");t&&!t.contains(e.target)&&t.remove()}));var d,m,p,f=(d=250,m=r,function(){clearTimeout(p),p=setTimeout(m,d)});r(),window.addEventListener("scroll",f,!0)})();